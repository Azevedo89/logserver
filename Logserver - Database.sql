-- MySQL Script generated by MySQL Workbench
-- Thu May  9 10:51:43 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema pfs_log
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema pfs_log
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `pfs_log` ;
-- -----------------------------------------------------
-- Schema emislog
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema emislog
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `emislog` ;
-- -----------------------------------------------------
-- Schema pfs_oparchlog
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema pfs_oparchlog
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `pfs_oparchlog` ;
-- -----------------------------------------------------
-- Schema pfs_oplog
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema pfs_oplog
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `pfs_oplog` ;
USE `pfs_log` ;

-- -----------------------------------------------------
-- Table `pfs_log`.`t_pfslog`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_log`.`t_pfslog` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `correlationId` VARCHAR(255) NULL DEFAULT NULL,
  `correlationIdParent` VARCHAR(255) NULL DEFAULT NULL,
  `date` DATE NULL DEFAULT NULL,
  `time` TIME NULL DEFAULT NULL,
  `io` VARCHAR(255) NULL DEFAULT NULL,
  `user` VARCHAR(10) NULL DEFAULT NULL,
  `station` VARCHAR(20) NULL DEFAULT NULL,
  `system` VARCHAR(600) NULL DEFAULT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `bankaversion` VARCHAR(3) NULL DEFAULT NULL,
  `sessionid` VARCHAR(10) NULL DEFAULT NULL,
  `api` VARCHAR(260) NULL DEFAULT NULL,
  `transaction` VARCHAR(160) NULL DEFAULT NULL,
  `apidata` LONGTEXT NULL DEFAULT NULL,
  `encryption` VARCHAR(20) NULL DEFAULT NULL,
  `licencekey` VARCHAR(10) NULL DEFAULT NULL,
  `expiration` VARCHAR(100) NULL DEFAULT NULL,
  `errorcode` VARCHAR(120) NULL DEFAULT NULL,
  `errormessage` VARCHAR(10000) NULL DEFAULT NULL,
  `paginatorapplied` SMALLINT NULL DEFAULT NULL,
  `paginatorcalls` SMALLINT NULL DEFAULT NULL,
  `onlynumregspecified` SMALLINT NULL DEFAULT NULL,
  `remoteaddr` VARCHAR(100) NULL DEFAULT NULL,
  `servername` VARCHAR(520) NULL DEFAULT NULL,
  `parameters` LONGTEXT NULL DEFAULT NULL,
  `https` BIT(1) NULL DEFAULT NULL,
  `correlation_id` VARCHAR(255) NULL DEFAULT NULL,
  INDEX `IDINDEX` (`id` ASC) VISIBLE,
  INDEX `DATE` (`date` ASC) VISIBLE,
  INDEX `USER` (`user` ASC) VISIBLE,
  INDEX `STATION` (`station` ASC) VISIBLE,
  INDEX `SYSTEM` (`system` ASC) VISIBLE,
  INDEX `SESSIONID` (`sessionid` ASC) VISIBLE,
  INDEX `API` (`api` ASC) VISIBLE,
  INDEX `TRANSACTION` (`transaction` ASC) VISIBLE,
  INDEX `CORRELATIONID` (`correlationId` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 5333013
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs PARTITION BY RANGE(to_days(`date`)) PARTITIONS 14( PARTITION p20240412 VALUES LESS THAN (739353),  PARTITION p20240419 VALUES LESS THAN (739360),  PARTITION p20240426 VALUES LESS THAN (739367),  PARTITION p20240503 VALUES LESS THAN (739374),  PARTITION p20240510 VALUES LESS THAN (739381),  PARTITION p20240517 VALUES LESS THAN (739388),  PARTITION p20240524 VALUES LESS THAN (739395),  PARTITION p20240531 VALUES LESS THAN (739402),  PARTITION p20240607 VALUES LESS THAN (739409),  PARTITION p20240614 VALUES LESS THAN (739416),  PARTITION p20240621 VALUES LESS THAN (739423),  PARTITION p20240628 VALUES LESS THAN (739430),  PARTITION p20240705 VALUES LESS THAN (739437),  PARTITION pMaxValue VALUES LESS THAN (MAX_VALUE)) ;


-- -----------------------------------------------------
-- Table `pfs_log`.`t_pfslogdtaq`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_log`.`t_pfslogdtaq` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `message_key` VARCHAR(600) NOT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `system` VARCHAR(600) NOT NULL,
  `dtaq` VARCHAR(600) NOT NULL,
  `app` VARCHAR(100) NOT NULL,
  `status` INT NOT NULL DEFAULT '0',
  `retries` INT NOT NULL DEFAULT '0',
  `correlationId` VARCHAR(255) NULL DEFAULT NULL,
  `xmlResponse` LONGTEXT NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 104708
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_log`.`t_users`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_log`.`t_users` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `firstname` VARCHAR(45) NOT NULL,
  `lastname` VARCHAR(45) NOT NULL,
  `username` VARCHAR(255) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `role` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 3
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;

USE `emislog` ;

-- -----------------------------------------------------
-- Table `emislog`.`t_emislog`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `emislog`.`t_emislog` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `library` VARCHAR(10) NOT NULL,
  `xmltype` VARCHAR(8) NULL DEFAULT NULL,
  `reqxml` LONGTEXT NULL DEFAULT NULL,
  `reqxmlparsing` VARCHAR(200) NULL DEFAULT NULL,
  `reqmessageid` VARCHAR(17) NULL DEFAULT NULL,
  `reqoperationid` VARCHAR(100) NULL DEFAULT NULL,
  `reqendpoint` VARCHAR(100) NULL DEFAULT NULL,
  `resxml` LONGTEXT NULL DEFAULT NULL,
  `resxmlsplit` LONGTEXT NULL DEFAULT NULL,
  `resxmlparsing` VARCHAR(400) NULL DEFAULT NULL,
  `resmessageid` VARCHAR(40) NULL DEFAULT NULL,
  `reserrorcode` VARCHAR(4) NULL DEFAULT NULL,
  `resstatus` VARCHAR(100) NULL DEFAULT NULL,
  `resismaster` BIT(1) NULL DEFAULT NULL,
  `reqdtaqoutread` TIMESTAMP NULL DEFAULT NULL,
  `reqdtaqinwrite` TIMESTAMP NULL DEFAULT NULL,
  `reqServiceId` VARCHAR(50) NULL DEFAULT NULL,
  `reqReceiverApplicationId` VARCHAR(50) NULL DEFAULT NULL,
  INDEX `IDINDEX` (`id` ASC) VISIBLE,
  INDEX `DATEINDEX` (`date` ASC) VISIBLE,
  INDEX `LIBRARYINDEX` (`library` ASC) VISIBLE,
  INDEX `XMLTYPEINDEX` (`xmltype` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 2852
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs PARTITION BY RANGE(to_days(`date`)) PARTITIONS 65( PARTITION p20230418 VALUES LESS THAN (738993),  PARTITION p20230425 VALUES LESS THAN (739000),  PARTITION p20230502 VALUES LESS THAN (739007),  PARTITION p20230509 VALUES LESS THAN (739014),  PARTITION p20230516 VALUES LESS THAN (739021),  PARTITION p20230523 VALUES LESS THAN (739028),  PARTITION p20230530 VALUES LESS THAN (739035),  PARTITION p20230606 VALUES LESS THAN (739042),  PARTITION p20230613 VALUES LESS THAN (739049),  PARTITION p20230620 VALUES LESS THAN (739056),  PARTITION p20230627 VALUES LESS THAN (739063),  PARTITION p20230704 VALUES LESS THAN (739070),  PARTITION p20230711 VALUES LESS THAN (739077),  PARTITION p20230718 VALUES LESS THAN (739084),  PARTITION p20230725 VALUES LESS THAN (739091),  PARTITION p20230801 VALUES LESS THAN (739098),  PARTITION p20230808 VALUES LESS THAN (739105),  PARTITION p20230815 VALUES LESS THAN (739112),  PARTITION p20230822 VALUES LESS THAN (739119),  PARTITION p20230829 VALUES LESS THAN (739126),  PARTITION p20230905 VALUES LESS THAN (739133),  PARTITION p20230912 VALUES LESS THAN (739140),  PARTITION p20230919 VALUES LESS THAN (739147),  PARTITION p20230926 VALUES LESS THAN (739154),  PARTITION p20231003 VALUES LESS THAN (739161),  PARTITION p20231010 VALUES LESS THAN (739168),  PARTITION p20231017 VALUES LESS THAN (739175),  PARTITION p20231024 VALUES LESS THAN (739182),  PARTITION p20231031 VALUES LESS THAN (739189),  PARTITION p20231107 VALUES LESS THAN (739196),  PARTITION p20231114 VALUES LESS THAN (739203),  PARTITION p20231121 VALUES LESS THAN (739210),  PARTITION p20231128 VALUES LESS THAN (739217),  PARTITION p20231205 VALUES LESS THAN (739224),  PARTITION p20231212 VALUES LESS THAN (739231),  PARTITION p20231219 VALUES LESS THAN (739238),  PARTITION p20231226 VALUES LESS THAN (739245),  PARTITION p20240102 VALUES LESS THAN (739252),  PARTITION p20240109 VALUES LESS THAN (739259),  PARTITION p20240116 VALUES LESS THAN (739266),  PARTITION p20240123 VALUES LESS THAN (739273),  PARTITION p20240130 VALUES LESS THAN (739280),  PARTITION p20240206 VALUES LESS THAN (739287),  PARTITION p20240213 VALUES LESS THAN (739294),  PARTITION p20240220 VALUES LESS THAN (739301),  PARTITION p20240227 VALUES LESS THAN (739308),  PARTITION p20240305 VALUES LESS THAN (739315),  PARTITION p20240312 VALUES LESS THAN (739322),  PARTITION p20240319 VALUES LESS THAN (739329),  PARTITION p20240326 VALUES LESS THAN (739336),  PARTITION p20240402 VALUES LESS THAN (739343),  PARTITION p20240409 VALUES LESS THAN (739350),  PARTITION p20240416 VALUES LESS THAN (739357),  PARTITION p20240423 VALUES LESS THAN (739364),  PARTITION p20240430 VALUES LESS THAN (739371),  PARTITION p20240507 VALUES LESS THAN (739378),  PARTITION p20240514 VALUES LESS THAN (739385),  PARTITION p20240521 VALUES LESS THAN (739392),  PARTITION p20240528 VALUES LESS THAN (739399),  PARTITION p20240604 VALUES LESS THAN (739406),  PARTITION p20240611 VALUES LESS THAN (739413),  PARTITION p20240618 VALUES LESS THAN (739420),  PARTITION p20240625 VALUES LESS THAN (739427),  PARTITION p20240702 VALUES LESS THAN (739434),  PARTITION pMaxValue VALUES LESS THAN (MAX_VALUE)) ;

USE `pfs_oparchlog` ;

-- -----------------------------------------------------
-- Table `pfs_oparchlog`.`databasechangelog`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oparchlog`.`databasechangelog` (
  `ID` VARCHAR(255) NOT NULL,
  `AUTHOR` VARCHAR(255) NOT NULL,
  `FILENAME` VARCHAR(255) NOT NULL,
  `DATEEXECUTED` DATETIME NOT NULL,
  `ORDEREXECUTED` INT NOT NULL,
  `EXECTYPE` VARCHAR(10) NOT NULL,
  `MD5SUM` VARCHAR(35) NULL DEFAULT NULL,
  `DESCRIPTION` VARCHAR(255) NULL DEFAULT NULL,
  `COMMENTS` VARCHAR(255) NULL DEFAULT NULL,
  `TAG` VARCHAR(255) NULL DEFAULT NULL,
  `LIQUIBASE` VARCHAR(20) NULL DEFAULT NULL,
  `CONTEXTS` VARCHAR(255) NULL DEFAULT NULL,
  `LABELS` VARCHAR(255) NULL DEFAULT NULL,
  `DEPLOYMENT_ID` VARCHAR(10) NULL DEFAULT NULL)
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oparchlog`.`databasechangeloglock`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oparchlog`.`databasechangeloglock` (
  `ID` INT NOT NULL,
  `LOCKED` BIT(1) NOT NULL,
  `LOCKGRANTED` DATETIME NULL DEFAULT NULL,
  `LOCKEDBY` VARCHAR(255) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oparchlog`.`t_oparclog`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oparchlog`.`t_oparclog` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `library` VARCHAR(10) NULL DEFAULT NULL,
  `reqmessage` LONGTEXT NULL DEFAULT NULL,
  `resmessage` LONGTEXT NULL DEFAULT NULL,
  `xmlstructuredsearchin` LONGTEXT NULL DEFAULT NULL,
  `xmlstructuredsearchout` LONGTEXT NULL DEFAULT NULL,
  `xmlextendedretrievein` LONGTEXT NULL DEFAULT NULL,
  `xmlextendedretrieveout` LONGTEXT NULL DEFAULT NULL,
  `resstatus` VARCHAR(100) NULL DEFAULT NULL,
  `reqdtaqoutread` DATETIME NULL DEFAULT NULL,
  `reqdtaqinwrite` DATETIME NULL DEFAULT NULL,
  `chqoperationtype` CHAR(1) NULL DEFAULT NULL,
  `chqdate` DATE NULL DEFAULT NULL,
  `chqhora` TIME NULL DEFAULT NULL,
  `chqzib` VARCHAR(8) NULL DEFAULT NULL,
  `chqaccountnumber` VARCHAR(13) NULL DEFAULT NULL,
  `chqchecknumber` VARCHAR(10) NULL DEFAULT NULL,
  `chqexpirationdate` DATE NULL DEFAULT NULL,
  `chqchecktype` VARCHAR(2) NULL DEFAULT NULL,
  `chqborrowerbank` VARCHAR(4) NULL DEFAULT NULL,
  `chqreferencearchive` VARCHAR(14) NULL DEFAULT NULL,
  `chqformtype` CHAR(1) NULL DEFAULT NULL,
  `chqbankbic` VARCHAR(11) NULL DEFAULT NULL,
  INDEX `IDINDEX` (`id` ASC) VISIBLE,
  INDEX `DATEINDEX` (`date` ASC) VISIBLE,
  INDEX `LIBRARYINDEX` (`library` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 35
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs PARTITION BY RANGE(to_days(`date`)) PARTITIONS 14( PARTITION p20240412 VALUES LESS THAN (739353),  PARTITION p20240419 VALUES LESS THAN (739360),  PARTITION p20240426 VALUES LESS THAN (739367),  PARTITION p20240503 VALUES LESS THAN (739374),  PARTITION p20240510 VALUES LESS THAN (739381),  PARTITION p20240517 VALUES LESS THAN (739388),  PARTITION p20240524 VALUES LESS THAN (739395),  PARTITION p20240531 VALUES LESS THAN (739402),  PARTITION p20240607 VALUES LESS THAN (739409),  PARTITION p20240614 VALUES LESS THAN (739416),  PARTITION p20240621 VALUES LESS THAN (739423),  PARTITION p20240628 VALUES LESS THAN (739430),  PARTITION p20240705 VALUES LESS THAN (739437),  PARTITION pMaxValue VALUES LESS THAN (MAX_VALUE)) ;

USE `pfs_oplog` ;

-- -----------------------------------------------------
-- Table `pfs_oplog`.`databasechangelog`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`databasechangelog` (
  `ID` VARCHAR(255) NOT NULL,
  `AUTHOR` VARCHAR(255) NOT NULL,
  `FILENAME` VARCHAR(255) NOT NULL,
  `DATEEXECUTED` DATETIME NOT NULL,
  `ORDEREXECUTED` INT NOT NULL,
  `EXECTYPE` VARCHAR(10) NOT NULL,
  `MD5SUM` VARCHAR(35) NULL DEFAULT NULL,
  `DESCRIPTION` VARCHAR(255) NULL DEFAULT NULL,
  `COMMENTS` VARCHAR(255) NULL DEFAULT NULL,
  `TAG` VARCHAR(255) NULL DEFAULT NULL,
  `LIQUIBASE` VARCHAR(20) NULL DEFAULT NULL,
  `CONTEXTS` VARCHAR(255) NULL DEFAULT NULL,
  `LABELS` VARCHAR(255) NULL DEFAULT NULL,
  `DEPLOYMENT_ID` VARCHAR(10) NULL DEFAULT NULL)
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`databasechangeloglock`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`databasechangeloglock` (
  `ID` INT NOT NULL,
  `LOCKED` BIT(1) NOT NULL,
  `LOCKGRANTED` DATETIME NULL DEFAULT NULL,
  `LOCKEDBY` VARCHAR(255) NULL DEFAULT NULL,
  PRIMARY KEY (`ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_op`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_op` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user` CHAR(10) NOT NULL,
  `station` CHAR(10) NOT NULL,
  `SYSTEM` CHAR(10) NOT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `api` CHAR(10) NOT NULL,
  `transaction` CHAR(10) NOT NULL,
  `parentopid` VARCHAR(10) NOT NULL,
  `opstep` VARCHAR(100) NULL DEFAULT NULL,
  `opncnt` VARCHAR(35) NULL DEFAULT NULL,
  `opncli` VARCHAR(10) NULL DEFAULT NULL,
  `opntrc` INT NULL DEFAULT NULL,
  `opnopr` VARCHAR(9) NULL DEFAULT NULL,
  `opndoc` VARCHAR(9) NULL DEFAULT NULL,
  `opvlr` DOUBLE NULL DEFAULT NULL,
  `opmoed` CHAR(3) NULL DEFAULT NULL,
  `opvlrs` VARCHAR(1000) NULL DEFAULT NULL,
  `opmoeds` VARCHAR(100) NULL DEFAULT NULL,
  `optipd` CHAR(3) NULL DEFAULT NULL,
  `opdif` VARCHAR(1000) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `trcxncx` CHAR(10) NULL DEFAULT NULL,
  `opclerk` CHAR(10) NULL DEFAULT NULL,
  `appdate` DATE NULL DEFAULT NULL,
  `opcope` CHAR(3) NULL DEFAULT NULL,
  `opdttr` CHAR(8) NULL DEFAULT NULL,
  `opdata` VARCHAR(25000) NOT NULL DEFAULT '',
  `operrors` VARCHAR(10000) NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  `optom` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  INDEX `DATE` (`date` ASC) VISIBLE,
  INDEX `USER` (`user` ASC) VISIBLE,
  INDEX `STATION` (`station` ASC) VISIBLE,
  INDEX `API` (`api` ASC) VISIBLE,
  INDEX `TRANSACTION` (`transaction` ASC) VISIBLE,
  INDEX `STATUS` (`status` ASC) VISIBLE,
  INDEX `PARENTOPID` (`parentopid` ASC) VISIBLE,
  INDEX `OPNOPR` (`opnopr` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 22917
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_authhist`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_authhist` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `userdif` CHAR(10) NOT NULL,
  `usernot` CHAR(10) NOT NULL,
  `opid` BIGINT NOT NULL,
  `userint` CHAR(10) NOT NULL,
  `motive` VARCHAR(40) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `userdifid` VARCHAR(100) NOT NULL DEFAULT '',
  `usernotid` VARCHAR(100) NOT NULL DEFAULT '',
  `userintid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  INDEX `FK_AUTHHIST_OP` (`opid` ASC) VISIBLE,
  CONSTRAINT `FK_AUTHHIST_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 126
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_op_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_op_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `user` CHAR(10) NOT NULL,
  `station` CHAR(10) NOT NULL,
  `SYSTEM` CHAR(10) NOT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `api` CHAR(10) NOT NULL,
  `transaction` CHAR(10) NOT NULL,
  `parentopid` VARCHAR(10) NOT NULL,
  `opstep` VARCHAR(100) NOT NULL,
  `opncnt` VARCHAR(35) NULL DEFAULT NULL,
  `opncli` VARCHAR(9) NULL DEFAULT NULL,
  `opntrc` INT NULL DEFAULT NULL,
  `opnopr` VARCHAR(9) NULL DEFAULT NULL,
  `opndoc` VARCHAR(9) NULL DEFAULT NULL,
  `opvlr` DOUBLE NULL DEFAULT NULL,
  `opmoed` CHAR(3) NULL DEFAULT NULL,
  `opvlrs` VARCHAR(1000) NULL DEFAULT NULL,
  `opmoeds` VARCHAR(100) NULL DEFAULT NULL,
  `optipd` CHAR(3) NULL DEFAULT NULL,
  `opdif` VARCHAR(1000) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `trcxncx` CHAR(10) NULL DEFAULT NULL,
  `opclerk` CHAR(10) NULL DEFAULT NULL,
  `appdate` DATE NULL DEFAULT NULL,
  `opcope` CHAR(3) NULL DEFAULT NULL,
  `opdttr` CHAR(8) NULL DEFAULT NULL,
  `opdata` VARCHAR(25000) NOT NULL DEFAULT '',
  `operrors` VARCHAR(10000) NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  `optom` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  INDEX `DATE` (`date` ASC) VISIBLE,
  INDEX `USER` (`user` ASC) VISIBLE,
  INDEX `STATION` (`station` ASC) VISIBLE,
  INDEX `API` (`api` ASC) VISIBLE,
  INDEX `TRANSACTION` (`transaction` ASC) VISIBLE,
  INDEX `STATUS` (`status` ASC) VISIBLE,
  INDEX `PARENTOPID` (`parentopid` ASC) VISIBLE,
  INDEX `OPNOPR` (`opnopr` ASC) VISIBLE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_authhist_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_authhist_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `userdif` CHAR(10) NOT NULL,
  `usernot` CHAR(10) NOT NULL,
  `opid` BIGINT NOT NULL,
  `userint` CHAR(10) NOT NULL,
  `motive` VARCHAR(40) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `userdifid` VARCHAR(100) NOT NULL DEFAULT '',
  `usernotid` VARCHAR(100) NOT NULL DEFAULT '',
  `userintid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  INDEX `FK_T_AUTHHIST_T_OP` (`opid` ASC) VISIBLE,
  CONSTRAINT `FK_T_AUTHHIST_T_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op_20230414` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_authreq`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_authreq` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `userdif` CHAR(10) NOT NULL,
  `usernot` CHAR(10) NOT NULL,
  `opid` BIGINT NOT NULL,
  `authorization` VARCHAR(1000) NULL DEFAULT NULL,
  `motive` VARCHAR(40) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `userdifid` VARCHAR(100) NOT NULL DEFAULT '',
  `usernotid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `sent` BIT(1) NULL DEFAULT b'0',
  PRIMARY KEY (`id`),
  INDEX `FK_AUTHREQ_OP` (`opid` ASC) VISIBLE,
  CONSTRAINT `FK_AUTHREQ_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 57
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_authreq_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_authreq_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `userdif` CHAR(10) NOT NULL,
  `usernot` CHAR(10) NOT NULL,
  `opid` BIGINT NOT NULL,
  `authorization` VARCHAR(1000) NULL DEFAULT NULL,
  `motive` VARCHAR(40) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `status` CHAR(10) NOT NULL,
  `userdifread` INT NOT NULL DEFAULT '0',
  `usernotread` INT NOT NULL DEFAULT '0',
  `userdifid` VARCHAR(100) NOT NULL DEFAULT '',
  `usernotid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  INDEX `authreq_op` (`opid` ASC) VISIBLE,
  CONSTRAINT `authreq_op`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op_20230414` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_authuser`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_authuser` (
  `userdif` CHAR(10) NOT NULL,
  `authuser` VARCHAR(100) NOT NULL,
  `authname` VARCHAR(100) NOT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  `authid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 22
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_biometric`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_biometric` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `station` CHAR(10) NOT NULL,
  `user` CHAR(10) NOT NULL,
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `successfulread` BIT(1) NOT NULL,
  `biometricmsg` VARCHAR(1000) NOT NULL,
  `finger` CHAR(2) NOT NULL,
  `value` DOUBLE NOT NULL,
  `client` BIGINT NOT NULL,
  `account` BIGINT NOT NULL,
  `bankaopid` BIGINT NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL,
  `opid` BIGINT NULL DEFAULT NULL,
  `feid` VARCHAR(100) NOT NULL,
  `image` LONGTEXT NOT NULL,
  `currency` CHAR(3) NOT NULL,
  `docnumber` VARCHAR(9) NULL DEFAULT NULL,
  `holdername` VARCHAR(40) NOT NULL,
  `holdernumber` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `OPERATIONID` (`opid` ASC) VISIBLE,
  INDEX `FRONTENDID` (`feid` ASC) VISIBLE,
  CONSTRAINT `FK_BIOMETRIC_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_biometric_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_biometric_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `station` CHAR(10) NOT NULL,
  `user` CHAR(10) NOT NULL,
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `successfulread` BIT(1) NOT NULL,
  `biometricmsg` VARCHAR(1000) NOT NULL,
  `finger` CHAR(2) NOT NULL,
  `value` DOUBLE NOT NULL,
  `client` BIGINT NOT NULL,
  `account` BIGINT NOT NULL,
  `bankaopid` BIGINT NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL,
  `opid` BIGINT NULL DEFAULT NULL,
  `feid` VARCHAR(100) NOT NULL,
  `image` LONGTEXT NOT NULL,
  `currency` CHAR(3) NOT NULL,
  `docnumber` VARCHAR(9) NULL DEFAULT NULL,
  `holdername` VARCHAR(40) NOT NULL,
  `holdernumber` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `OPERATIONID` (`opid` ASC) VISIBLE,
  INDEX `FRONTENDID` (`feid` ASC) VISIBLE,
  CONSTRAINT `FK_T_BIOMETRIC_T_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op_20230414` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_print`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_print` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `station` CHAR(10) NOT NULL,
  `user` CHAR(10) NOT NULL,
  `trans` VARCHAR(10) NOT NULL,
  `bankaopid` BIGINT NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `opid` BIGINT NULL DEFAULT NULL,
  `copynumber` INT NOT NULL,
  `rdate` DATE NULL DEFAULT NULL,
  `rtime` TIME NULL DEFAULT NULL,
  `status` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `DATE` (`date` ASC) VISIBLE,
  INDEX `TRANSACTION` (`trans` ASC) VISIBLE,
  INDEX `OPERATIONID` (`bankaopid` ASC) VISIBLE,
  INDEX `FK_PRINT_OP` (`opid` ASC) VISIBLE,
  CONSTRAINT `FK_PRINT_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 3749
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_print_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_print_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `station` CHAR(10) NOT NULL,
  `user` CHAR(10) NOT NULL,
  `trans` VARCHAR(10) NOT NULL,
  `bankaopid` BIGINT NULL DEFAULT NULL,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  `bankacode` CHAR(4) NULL DEFAULT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `opid` BIGINT NULL DEFAULT NULL,
  `copynumber` INT NOT NULL,
  `rdate` DATE NULL DEFAULT NULL,
  `rtime` TIME NULL DEFAULT NULL,
  `status` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `DATE` (`date` ASC) VISIBLE,
  INDEX `TRANSACTION` (`trans` ASC) VISIBLE,
  INDEX `OPERATIONID` (`bankaopid` ASC) VISIBLE,
  INDEX `FK_T_PRINT_T_OP` (`opid` ASC) VISIBLE,
  CONSTRAINT `FK_T_PRINT_T_OP`
    FOREIGN KEY (`opid`)
    REFERENCES `pfs_oplog`.`t_op_20230414` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_report`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_report` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `user` VARCHAR(10) NULL DEFAULT NULL,
  `station` VARCHAR(10) NULL DEFAULT NULL,
  `SYSTEM` VARCHAR(4) NULL DEFAULT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `transactionvalues` LONGTEXT NULL DEFAULT NULL,
  `errorcode` VARCHAR(10) NULL DEFAULT NULL,
  `reportname` VARCHAR(30) NULL DEFAULT NULL,
  `reportvalues` LONGTEXT NULL DEFAULT NULL,
  `export` VARCHAR(10) NULL DEFAULT NULL,
  `TYPE` VARCHAR(10) NULL DEFAULT NULL,
  `language` VARCHAR(2) NULL DEFAULT NULL,
  `jdbcdriver` VARCHAR(50) NULL DEFAULT NULL,
  `jdbcurl` VARCHAR(100) NULL DEFAULT NULL,
  `dbuser` VARCHAR(20) NULL DEFAULT NULL,
  `generatedreport` LONGTEXT NULL DEFAULT NULL,
  `errormessage` VARCHAR(10000) NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`, `date`))
ENGINE = InnoDB
AUTO_INCREMENT = 3102
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs PARTITION BY RANGE(to_days(`date`)) PARTITIONS 22( PARTITION p20240216 VALUES LESS THAN (739297),  PARTITION p20240223 VALUES LESS THAN (739304),  PARTITION p20240301 VALUES LESS THAN (739311),  PARTITION p20240308 VALUES LESS THAN (739318),  PARTITION p20240315 VALUES LESS THAN (739325),  PARTITION p20240322 VALUES LESS THAN (739332),  PARTITION p20240329 VALUES LESS THAN (739339),  PARTITION p20240405 VALUES LESS THAN (739346),  PARTITION p20240412 VALUES LESS THAN (739353),  PARTITION p20240419 VALUES LESS THAN (739360),  PARTITION p20240426 VALUES LESS THAN (739367),  PARTITION p20240503 VALUES LESS THAN (739374),  PARTITION p20240510 VALUES LESS THAN (739381),  PARTITION p20240517 VALUES LESS THAN (739388),  PARTITION p20240524 VALUES LESS THAN (739395),  PARTITION p20240531 VALUES LESS THAN (739402),  PARTITION p20240607 VALUES LESS THAN (739409),  PARTITION p20240614 VALUES LESS THAN (739416),  PARTITION p20240621 VALUES LESS THAN (739423),  PARTITION p20240628 VALUES LESS THAN (739430),  PARTITION p20240705 VALUES LESS THAN (739437),  PARTITION pMaxValue VALUES LESS THAN (MAX_VALUE)) ;


-- -----------------------------------------------------
-- Table `pfs_oplog`.`t_report_20230414`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pfs_oplog`.`t_report_20230414` (
  `id` BIGINT NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `time` TIME NOT NULL,
  `user` VARCHAR(10) NULL DEFAULT NULL,
  `station` VARCHAR(10) NULL DEFAULT NULL,
  `SYSTEM` VARCHAR(4) NULL DEFAULT NULL,
  `application` VARCHAR(40) NULL DEFAULT NULL,
  `transactionvalues` LONGTEXT NULL DEFAULT NULL,
  `errorcode` VARCHAR(10) NULL DEFAULT NULL,
  `reportname` VARCHAR(20) NULL DEFAULT NULL,
  `reportvalues` LONGTEXT NULL DEFAULT NULL,
  `export` VARCHAR(10) NULL DEFAULT NULL,
  `TYPE` VARCHAR(10) NULL DEFAULT NULL,
  `language` VARCHAR(2) NULL DEFAULT NULL,
  `jdbcdriver` VARCHAR(50) NULL DEFAULT NULL,
  `jdbcurl` VARCHAR(100) NULL DEFAULT NULL,
  `dbuser` VARCHAR(20) NULL DEFAULT NULL,
  `generatedreport` LONGTEXT NULL DEFAULT NULL,
  `errormessage` VARCHAR(10000) NULL DEFAULT NULL,
  `userid` VARCHAR(100) NOT NULL DEFAULT '',
  PRIMARY KEY (`id`, `date`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = latin1
COLLATE = latin1_general_cs PARTITION BY RANGE(to_days(`date`)) PARTITIONS 10( PARTITION p20230414 VALUES LESS THAN (738989),  PARTITION p20230421 VALUES LESS THAN (738996),  PARTITION p20230428 VALUES LESS THAN (739003),  PARTITION p20230505 VALUES LESS THAN (739010),  PARTITION p20230512 VALUES LESS THAN (739017),  PARTITION p20230519 VALUES LESS THAN (739024),  PARTITION p20230526 VALUES LESS THAN (739031),  PARTITION p20230602 VALUES LESS THAN (739038),  PARTITION p20230609 VALUES LESS THAN (739045),  PARTITION pMaxValue VALUES LESS THAN (MAX_VALUE)) ;

USE `pfs_log` ;

-- -----------------------------------------------------
-- procedure ADD_PARTITION
-- -----------------------------------------------------

DELIMITER $$
USE `pfs_log`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `ADD_PARTITION`()
BEGIN	
			   
				SET @dateNow = CURDATE();
				
				SET @nextTwoMonth = DATE_ADD(@dateNow,INTERVAL 2 MONTH);
				
				SET @lastPartition = (SELECT PARTITION_DESCRIPTION 
					FROM information_schema.PARTITIONS 
					WHERE TABLE_SCHEMA = 'pfs_log' 
					AND TABLE_NAME = 't_pfslog' 
					ORDER BY PARTITION_ORDINAL_POSITION 
					DESC LIMIT 1, 1);
								
				SET @lastPartitionDate = FROM_DAYS(@lastPartition);
				
				SET @newPartition = DATE_ADD(@lastPartitionDate,INTERVAL 7 DAY);
					
				SET @strPartitions = '';
						
				IF (@lastPartitionDate < @nextTwoMonth) THEN
				
					WHILE (@newPartition < @nextTwoMonth) DO
						
						SET @strPartitions = CONCAT(@strPartitions, ' PARTITION p'
											, DATE_FORMAT(@newPartition, '%Y%m%d')
						                  	, ' VALUES LESS THAN ('
						                  	, TO_DAYS(@newPartition)
						                  	, '),');			                  
						                  
						SET @newPartition = DATE_ADD(@newPartition,INTERVAL 7 DAY);
				
					END WHILE;
					
					SET @queryString = CONCAT('ALTER TABLE t_pfslog '
												, 'REORGANIZE PARTITION pMaxValue INTO ('
												, 	@strPartitions
												, 'PARTITION pMaxValue VALUES LESS THAN MAXVALUE);');
			
					PREPARE stmt FROM @queryString;
					EXECUTE stmt;
					DEALLOCATE PREPARE stmt;
			
				END IF;
			   
			END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure RENAME_LOG_TABLE
-- -----------------------------------------------------

DELIMITER $$
USE `pfs_log`$$
CREATE DEFINER=`root`@`%` PROCEDURE `RENAME_LOG_TABLE`()
BEGIN
        SET @pfslogrow = ( select count(1) from (
                    SELECT * 
                    FROM t_pfslog as l 
                    LIMIT 1
                ) t );
  
        If @pfslogrow > 0
        THEN
          SET @pfsLogDate = ( DATE_FORMAT(NOW(), '%Y%m%d%H%i%s') );
  
          CREATE TABLE t_pfslog_new LIKE t_pfslog;
  
          SET @pfsRenameTable = CONCAT('RENAME TABLE t_pfslog TO t_pfslog_', @pfsLogDate, ', t_pfslog_new TO t_pfslog');
  
          PREPARE pfsRenameTable FROM @pfsRenameTable;
          EXECUTE pfsRenameTable;
          DEALLOCATE PREPARE pfsRenameTable;
  
        END IF;
      END$$

DELIMITER ;
USE `emislog` ;

-- -----------------------------------------------------
-- procedure ADD_PARTITION
-- -----------------------------------------------------

DELIMITER $$
USE `emislog`$$
CREATE DEFINER=`root`@`%` PROCEDURE `ADD_PARTITION`()
BEGIN

				SET @dateNow = CURDATE();

				SET @nextTwoMonth = DATE_ADD(@dateNow,INTERVAL 2 MONTH);

				SET @lastPartition = (SELECT PARTITION_DESCRIPTION
					FROM information_schema.PARTITIONS
					WHERE TABLE_SCHEMA = 'emislog'
					AND TABLE_NAME = 't_emislog'
					ORDER BY PARTITION_ORDINAL_POSITION
					DESC LIMIT 1, 1);

				SET @lastPartitionDate = FROM_DAYS(@lastPartition);

				SET @newPartition = DATE_ADD(@lastPartitionDate,INTERVAL 7 DAY);

				SET @strPartitions = '';

				IF (@lastPartitionDate < @nextTwoMonth) THEN

					WHILE (@newPartition < @nextTwoMonth) DO

						SET @strPartitions = CONCAT(@strPartitions, ' PARTITION p'
											, DATE_FORMAT(@newPartition, '%Y%m%d')
						                  	, ' VALUES LESS THAN ('
						                  	, TO_DAYS(@newPartition)
						                  	, '),');

						SET @newPartition = DATE_ADD(@newPartition,INTERVAL 7 DAY);

					END WHILE;

					SET @queryString = CONCAT('ALTER TABLE t_emislog '
										, 'REORGANIZE PARTITION pMaxValue INTO ('
										, 	@strPartitions
										, 'PARTITION pMaxValue VALUES LESS THAN MAXVALUE);');

					PREPARE stmt FROM @queryString;
					EXECUTE stmt;
					DEALLOCATE PREPARE stmt;

				END IF;

			END$$

DELIMITER ;
USE `pfs_oparchlog` ;

-- -----------------------------------------------------
-- procedure ADD_PARTITION
-- -----------------------------------------------------

DELIMITER $$
USE `pfs_oparchlog`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `ADD_PARTITION`()
BEGIN	
			   
				SET @dateNow = CURDATE();
				
				SET @nextTwoMonth = DATE_ADD(@dateNow,INTERVAL 2 MONTH);
				
				SET @lastPartition = (SELECT PARTITION_DESCRIPTION 
					FROM information_schema.PARTITIONS 
					WHERE TABLE_SCHEMA = 'pfs_oparchlog' 
					AND TABLE_NAME = 't_oparclog' 
					ORDER BY PARTITION_ORDINAL_POSITION 
					DESC LIMIT 1, 1);
								
				SET @lastPartitionDate = FROM_DAYS(@lastPartition);
				
				SET @newPartition = DATE_ADD(@lastPartitionDate,INTERVAL 7 DAY);
					
				SET @strPartitions = '';
						
				IF (@lastPartitionDate < @nextTwoMonth) THEN
				
					WHILE (@newPartition < @nextTwoMonth) DO
						
						SET @strPartitions = CONCAT(@strPartitions, ' PARTITION p'
											, DATE_FORMAT(@newPartition, '%Y%m%d')
						                  	, ' VALUES LESS THAN ('
						                  	, TO_DAYS(@newPartition)
						                  	, '),');			                  
						                  
						SET @newPartition = DATE_ADD(@newPartition,INTERVAL 7 DAY);
				
					END WHILE;
					
					SET @queryString = CONCAT('ALTER TABLE t_oparclog '
										, 'REORGANIZE PARTITION pMaxValue INTO ('
										, 	@strPartitions
										, 'PARTITION pMaxValue VALUES LESS THAN MAXVALUE);');
			
					PREPARE stmt FROM @queryString;
					EXECUTE stmt;
					DEALLOCATE PREPARE stmt;
			
				END IF;
			   
			END$$

DELIMITER ;
USE `pfs_oplog` ;

-- -----------------------------------------------------
-- procedure ADD_PARTITION
-- -----------------------------------------------------

DELIMITER $$
USE `pfs_oplog`$$
CREATE DEFINER=`root`@`localhost` PROCEDURE `ADD_PARTITION`()
BEGIN	
			   
				SET @dateNow = CURDATE();
				
				SET @nextTwoMonth = DATE_ADD(@dateNow,INTERVAL 2 MONTH);
				
				SET @lastPartition = (SELECT PARTITION_DESCRIPTION 
					FROM information_schema.PARTITIONS 
					WHERE TABLE_SCHEMA = 'pfs_oplog' 
					AND TABLE_NAME = 't_report' 
					ORDER BY PARTITION_ORDINAL_POSITION 
					DESC LIMIT 1, 1);
								
				SET @lastPartitionDate = FROM_DAYS(@lastPartition);
				
				SET @newPartition = DATE_ADD(@lastPartitionDate,INTERVAL 7 DAY);
					
				SET @strPartitions = '';
						
				IF (@lastPartitionDate < @nextTwoMonth) THEN
				
					WHILE (@newPartition < @nextTwoMonth) DO
						
						SET @strPartitions = CONCAT(@strPartitions, ' PARTITION p'
											, DATE_FORMAT(@newPartition, '%Y%m%d')
						                  	, ' VALUES LESS THAN ('
						                  	, TO_DAYS(@newPartition)
						                  	, '),');			                  
						                  
						SET @newPartition = DATE_ADD(@newPartition,INTERVAL 7 DAY);
				
					END WHILE;
					
					SET @queryString = CONCAT('ALTER TABLE t_report '
												, 'REORGANIZE PARTITION pMaxValue INTO ('
												, 	@strPartitions
												, 'PARTITION pMaxValue VALUES LESS THAN MAXVALUE);');
			
					PREPARE stmt FROM @queryString;
					EXECUTE stmt;
					DEALLOCATE PREPARE stmt;
			
				END IF;
			   
			END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure ALL_BACKUP_LOGS
-- -----------------------------------------------------

DELIMITER $$
USE `pfs_oplog`$$
CREATE DEFINER=`root`@`%` PROCEDURE `ALL_BACKUP_LOGS`()
BEGIN
            	CALL BACKUP_LOGS('t_print', 90, 'C:/logs/', 'pfs_oplog'); 
            	CALL BACKUP_LOGS('t_authhist', 90, 'C:/logs/', 'pfs_oplog'); 
            	CALL BACKUP_LOGS('t_authreq', 90, 'C:/logs/', 'pfs_oplog'); 
            	CALL BACKUP_LOGS('t_biometric', 90, 'C:/logs/', 'pfs_oplog'); 
            	CALL BACKUP_LOGS('t_report', 90, 'C:/logs/', 'pfs_oplog'); 
            	CALL BACKUP_LOGS('t_op', 90, 'C:/logs/', 'pfs_oplog');
            END$$

DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
